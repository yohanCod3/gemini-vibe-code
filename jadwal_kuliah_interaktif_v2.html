<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jadwal Kuliah Interaktif</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutral (Slate & Teal) -->
    <!-- Application Structure Plan: A daily-focused dashboard. Users select a day via tabs to view that day's schedule cards. A prominent "Today's Schedule" section provides immediate context. A bar chart visualizes the weekly workload. New features include a checklist for weekly attendance, a recap section with a download button, and data persistence via local storage. This structure centralizes all weekly class-related tasks—viewing, attending, and reviewing—in one cohesive, reliable interface. -->
    <!-- Visualization & Content Choices: 1. Schedule Data -> Goal: Inform/Organize -> Presentation: HTML Cards with Checkboxes -> Interaction: Filtered by day-selection tabs (JS), checkbox toggles attendance state which is saved to local storage -> Justification: The checklist format is intuitive for attendance tracking, and local storage ensures data is persistent. 2. Weekly Load -> Goal: Compare -> Presentation: Bar Chart -> Interaction: Static visualization -> Justification: Provides a quick, visual comparison of daily class hours -> Library: Chart.js (Canvas). 3. Today's Highlight -> Goal: Inform -> Presentation: Dynamic Text/Card list -> Interaction: Automatic based on current date (JS) -> Justification: Offers immediate, relevant information upon loading the app. 4. Weekly Recap -> Goal: Inform -> Presentation: Dynamic Text List -> Interaction: Generates and downloads a text file on button click -> Justification: A simple list effectively summarizes attendance data and a download feature allows for personal record keeping. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
    </style>
</head>

<body class="text-slate-800">

    <div class="container mx-auto p-4 sm:p-6 md:p-8">

        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-teal-700">Jadwal Kuliah S1 Informatika</h1>
            <p class="text-slate-500 mt-2">Absensi kelas mingguan semester 1</p>
        </header>

        <main>
            <section id="today-schedule" class="mb-8 bg-white p-6 rounded-xl shadow-md border border-slate-200">
                <h2 class="text-2xl font-bold mb-4 text-teal-600">Jadwal Hari Ini</h2>
                <div id="today-content" class="text-slate-600">
                    <p>Memuat jadwal untuk hari ini...</p>
                </div>
            </section>

            <section id="weekly-view" class="mb-8">
                <h2 class="text-2xl font-bold mb-4 text-center text-teal-600">Kelas minggu ini</h2>
                <div class="flex flex-wrap justify-center gap-2 mb-6" id="day-selector">
                    <button data-day="Senin"
                        class="day-btn px-4 py-2 rounded-full text-sm font-semibold transition-all duration-300 ease-in-out bg-slate-200 text-slate-700 hover:bg-teal-500 hover:text-white">Senin</button>
                    <button data-day="Selasa"
                        class="day-btn px-4 py-2 rounded-full text-sm font-semibold transition-all duration-300 ease-in-out bg-slate-200 text-slate-700 hover:bg-teal-500 hover:text-white">Selasa</button>
                    <button data-day="Rabu"
                        class="day-btn px-4 py-2 rounded-full text-sm font-semibold transition-all duration-300 ease-in-out bg-slate-200 text-slate-700 hover:bg-teal-500 hover:text-white">Rabu</button>
                    <button data-day="Kamis"
                        class="day-btn px-4 py-2 rounded-full text-sm font-semibold transition-all duration-300 ease-in-out bg-slate-200 text-slate-700 hover:bg-teal-500 hover:text-white">Kamis</button>
                    <button data-day="Jumat"
                        class="day-btn px-4 py-2 rounded-full text-sm font-semibold transition-all duration-300 ease-in-out bg-slate-200 text-slate-700 hover:bg-teal-500 hover:text-white">Jumat</button>
                </div>
                <div id="schedule-display" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

                </div>
            </section>

            <section id="workload-analysis" class="mb-8 bg-white p-6 rounded-xl shadow-md border border-slate-200">
                <h2 class="text-2xl font-bold mb-4 text-center text-teal-600">Analisis Beban Belajar</h2>
                <p class="text-center text-slate-500 mb-6">Visualisasi ini menunjukkan total durasi jam kuliah Anda
                    setiap hari. Gunakan ini untuk merencanakan waktu belajar dan istirahat Anda secara efektif
                    sepanjang minggu.</p>
                <div class="chart-container">
                    <canvas id="workloadChart"></canvas>
                </div>
            </section>

            <section id="weekly-recap" class="bg-white p-6 rounded-xl shadow-md border border-slate-200">
                <h2 class="text-2xl font-bold mb-4 text-center text-teal-600">Rekapitulasi Presensi Mingguan</h2>
                <div id="recap-content" class="text-slate-600 space-y-4">
                    <p class="text-center text-slate-500">Rekapitulasi presensi akan muncul di sini.</p>
                </div>
                <div class="mt-6 text-center">
                    <button id="download-recap-btn"
                        class="px-6 py-2 rounded-full bg-teal-600 text-white font-semibold shadow-md hover:bg-teal-700 transition-colors duration-300">
                        Unduh Rekapitulasi
                    </button>
                </div>
            </section>
        </main>

    </div>

    <script>
        const scheduleData = [
            { day: 'Senin', subject: 'Matematika Diskrit', startTime: '10:00', endTime: '12:30', location: '402', classType: 'Reguler P1' },
            { day: 'Selasa', subject: 'Arsitektur & Organisasi Komputer', startTime: '10:00', endTime: '12:30', location: '505', classType: 'Reguler P1' },
            { day: 'Rabu', subject: 'Sistem Operasi', startTime: '10:00', endTime: '12:30', location: 'Lab Komputer 3', classType: 'Reguler P1' },
            { day: 'Rabu', subject: 'Agama', startTime: '13:00', endTime: '14:40', location: 'Auditorium', classType: 'Reguler P4' },
            { day: 'Kamis', subject: 'Sistem Digital', startTime: '07:00', endTime: '09:30', location: 'Lab Komputer 3', classType: 'Reguler P1' },
            { day: 'Kamis', subject: 'Pemrograman Dasar', startTime: '10:00', endTime: '11:40', location: 'Lab Komputer 3', classType: 'Reguler P1' },
            { day: 'Jumat', subject: 'Pemrograman Dasar', startTime: '13:00', endTime: '14:40', location: 'Lab Komputer 3', classType: 'Reguler P1' },
            { day: 'Jumat', subject: 'Pancasila', startTime: '15:45', endTime: '17:25', location: 'Function Hall', classType: 'Reguler P4' },
        ];

        let attendanceStatus = {};

        const scheduleDisplay = document.getElementById('schedule-display');
        const daySelector = document.getElementById('day-selector');
        const todayContent = document.getElementById('today-content');
        const recapContent = document.getElementById('recap-content');
        const dayButtons = document.querySelectorAll('.day-btn');
        const downloadButton = document.getElementById('download-recap-btn');

        function parseTime(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }

        function calculateDuration(startTime, endTime) {
            const startMinutes = parseTime(startTime);
            const endMinutes = parseTime(endTime);
            return (endMinutes - startMinutes) / 60;
        }

        function createCard(item) {
            const uniqueId = `${item.day}-${item.subject}-${item.startTime}`;
            const attendanceRecord = attendanceStatus[uniqueId] || { status: 'Hadir', date: '' };
            const isAttended = attendanceRecord.status !== 'Izin';
            const statusText = isAttended ? 'Hadir' : 'Izin';
            return `
                <div class="bg-white p-5 rounded-xl shadow-lg border border-slate-100 transform hover:scale-105 transition-transform duration-300">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="font-bold text-lg text-teal-700">${item.subject}</h3>
                        <label class="inline-flex items-center cursor-pointer">
                            <input type="checkbox" class="attendance-checkbox form-checkbox h-5 w-5 text-teal-600 rounded" data-id="${uniqueId}" ${isAttended ? 'checked' : ''}>
                            <span class="ml-2 text-sm text-slate-600">${statusText}</span>
                        </label>
                    </div>
                    <p class="text-slate-600 font-medium">${item.startTime} - ${item.endTime}</p>
                    <div class="mt-4 text-sm space-y-2">
                        <p class="flex items-center">
                            <span class="w-5 h-5 mr-2 inline-flex items-center justify-center text-teal-600">📍</span>
                            <span>${item.location}</span>
                        </p>
                        <p class="flex items-center">
                            <span class="w-5 h-5 mr-2 inline-flex items-center justify-center text-teal-600">🧑‍🏫</span>
                            <span>${item.classType}</span>
                        </p>
                    </div>
                </div>
            `;
        }

        function renderSchedule(day) {
            const filteredData = scheduleData.filter(item => item.day === day);
            scheduleDisplay.innerHTML = '';
            if (filteredData.length > 0) {
                filteredData.forEach((item) => {
                    scheduleDisplay.innerHTML += createCard(item);
                });
            } else {
                scheduleDisplay.innerHTML = `<p class="text-center text-slate-500 col-span-full">Tidak ada jadwal untuk hari ${day}.</p>`;
            }
        }

        function renderTodaySchedule() {
            const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
            const today = new Date();
            const todayName = days[today.getDay()];

            const todayData = scheduleData.filter(item => item.day === todayName);

            todayContent.innerHTML = '';
            if (todayData.length > 0) {
                const list = document.createElement('div');
                list.className = 'space-y-4';
                todayData.forEach((item) => {
                    const card = document.createElement('div');
                    card.innerHTML = createCard(item);
                    list.appendChild(card.firstChild);
                });
                todayContent.appendChild(list);

            } else {
                todayContent.innerHTML = `<p class="text-center text-slate-500">Tidak ada jadwal kuliah hari ini. Waktu bebas!</p>`;
            }
            return todayName;
        }

        function setActiveButton(activeDay) {
            dayButtons.forEach(button => {
                if (button.dataset.day === activeDay) {
                    button.classList.remove('bg-slate-200', 'text-slate-700');
                    button.classList.add('bg-teal-600', 'text-white', 'shadow-md');
                } else {
                    button.classList.add('bg-slate-200', 'text-slate-700');
                    button.classList.remove('bg-teal-600', 'text-white', 'shadow-md');
                }
            });
        }

        daySelector.addEventListener('click', (e) => {
            if (e.target.classList.contains('day-btn')) {
                const selectedDay = e.target.dataset.day;
                setActiveButton(selectedDay);
                renderSchedule(selectedDay);
            }
        });

        scheduleDisplay.addEventListener('change', (e) => {
            if (e.target.classList.contains('attendance-checkbox')) {
                const id = e.target.dataset.id;
                const currentDate = new Date().toISOString().slice(0, 10);
                attendanceStatus[id] = {
                    status: e.target.checked ? 'Hadir' : 'Izin',
                    date: currentDate
                };
                e.target.nextElementSibling.textContent = e.target.checked ? 'Hadir' : 'Izin';
                localStorage.setItem('attendanceStatus', JSON.stringify(attendanceStatus));
                updateRecap();
            }
        });

        function updateRecap() {
            let attendedClasses = [];
            let absentClasses = [];

            // Iterasi melalui data presensi yang telah disimpan
            for (const uniqueId in attendanceStatus) {
                const statusData = attendanceStatus[uniqueId];
                const parts = uniqueId.split('-');
                const item = {
                    day: parts[0],
                    subject: parts[1],
                    startTime: parts[2]
                };

                if (statusData.status === 'Izin') {
                    absentClasses.push({ ...item, date: statusData.date });
                } else {
                    attendedClasses.push({ ...item, date: statusData.date });
                }
            }

            let recapHtml = `
                <p><strong>Jumlah kelas yang dihadiri:</strong> ${attendedClasses.length}</p>
                <p><strong>Jumlah kelas yang diizinkan:</strong> ${absentClasses.length}</p>
                <h3 class="font-bold text-lg mt-4">Daftar Kelas yang Dihadiri:</h3>
                <ul class="list-disc list-inside space-y-1">
                    ${attendedClasses.map(item => `<li>${item.subject} (${item.day}, ${item.startTime}) - <span class="text-green-600 font-semibold">Hadir</span> <span class="text-slate-500 text-sm">(${item.date})</span></li>`).join('')}
                </ul>
                <h3 class="font-bold text-lg mt-4">Daftar Kelas yang Tidak Dihadiri/Izin:</h3>
                <ul class="list-disc list-inside space-y-1">
                    ${absentClasses.map(item => `<li>${item.subject} (${item.day}, ${item.startTime}) - <span class="text-red-600 font-semibold">Izin</span> <span class="text-slate-500 text-sm">(${item.date})</span></li>`).join('')}
                </ul>
            `;

            if (attendedClasses.length + absentClasses.length === 0) {
                recapHtml = `<p class="text-center text-slate-500">Anda belum menandai presensi apapun.</p>`;
            }

            recapContent.innerHTML = recapHtml;
        }

        function downloadRecap() {
            let recapText = `REKAPITULASI PRESENSI MINGGUAN\n\n`;

            let attendedClasses = [];
            let absentClasses = [];

            for (const uniqueId in attendanceStatus) {
                const statusData = attendanceStatus[uniqueId];
                const parts = uniqueId.split('-');
                const item = {
                    day: parts[0],
                    subject: parts[1],
                    startTime: parts[2]
                };

                if (statusData.status === 'Izin') {
                    absentClasses.push({ ...item, date: statusData.date });
                } else {
                    attendedClasses.push({ ...item, date: statusData.date });
                }
            }

            recapText += `Total kelas yang dihadiri: ${attendedClasses.length}\n`;
            recapText += `Total kelas yang diizinkan: ${absentClasses.length}\n\n`;

            recapText += `--- Kelas yang Dihadiri ---\n`;
            attendedClasses.forEach(item => {
                recapText += `- ${item.subject} (${item.day}, ${item.startTime}) - Hadir (${item.date})\n`;
            });
            recapText += `\n`;

            recapText += `--- Kelas yang Tidak Dihadiri/Izin ---\n`;
            absentClasses.forEach(item => {
                recapText += `- ${item.subject} (${item.day}, ${item.startTime}) - Izin (${item.date})\n`;
            });

            const blob = new Blob([recapText], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'rekapitulasi_presensi.txt';
            link.click();
            URL.revokeObjectURL(url);
        }

        downloadButton.addEventListener('click', downloadRecap);

        function renderWorkloadChart() {
            const daysOfWeek = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat'];
            const workloadData = daysOfWeek.map(day => {
                return scheduleData
                    .filter(item => item.day === day)
                    .reduce((total, item) => total + calculateDuration(item.startTime, item.endTime), 0);
            });

            const ctx = document.getElementById('workloadChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: daysOfWeek,
                    datasets: [{
                        label: 'Total Jam Kuliah',
                        data: workloadData,
                        backgroundColor: 'rgba(15, 118, 110, 0.6)',
                        borderColor: 'rgba(13, 148, 136, 1)',
                        borderWidth: 1,
                        borderRadius: 8,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Jam'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += context.parsed.y.toFixed(2) + ' jam';
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const storedStatus = localStorage.getItem('attendanceStatus');
            if (storedStatus) {
                attendanceStatus = JSON.parse(storedStatus);
            } else {
                scheduleData.forEach((item) => {
                    const uniqueId = `${item.day}-${item.subject}-${item.startTime}`;
                    attendanceStatus[uniqueId] = {
                        status: 'Hadir',
                        date: new Date().toISOString().slice(0, 10)
                    };
                });
            }

            const currentDay = renderTodaySchedule();
            const scheduleDays = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat'];
            let initialDay = currentDay;
            if (!scheduleDays.includes(currentDay)) {
                initialDay = 'Senin';
            }

            setActiveButton(initialDay);
            renderSchedule(initialDay);
            renderWorkloadChart();
            updateRecap();
        });

    </script>
</body>

</html>